<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="popup.css">
  <link rel="stylesheet" href="auth.css">
  <link rel="stylesheet" href="feed.css">
</head>
<body>
  <div class="container" id="app">
    <!-- Loading State -->
    <div id="loading-state" class="loading-overlay">
      <div class="loading-spinner"></div>
      <p>Loading V-Try.app...</p>
    </div>

    <!-- Authentication Required State -->
    <div id="auth-required" class="auth-container" style="display: none;">
      <div class="header">
        <img src="icons/icon48.png" alt="V-Try.app" class="logo">
        <h1>V-Try.app</h1>
        <p>AI Virtual Try-On Platform</p>
      </div>
      
      <div class="auth-content">
        <div class="auth-message">
          <h3>🔐 Authentication Required</h3>
          <p>Sign in to start trying on products with AI</p>
        </div>
        
        <div class="auth-buttons">
          <button id="login-btn" class="btn btn-primary">
            Sign In
          </button>
          <button id="signup-btn" class="btn btn-secondary">
            Create Account
          </button>
        </div>
        
        <div class="auth-benefits">
          <h4>✨ What you get:</h4>
          <ul>
            <li>🎭 Unlimited AI try-ons</li>
            <li>📱 Personal feed & history</li>
            <li>🎬 Video generation</li>
            <li>🔗 Product link tracking</li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Profile Setup Required -->
    <div id="profile-setup" class="setup-container" style="display: none;">
      <div class="header">
        <img src="icons/icon48.png" alt="V-Try.app" class="logo">
        <h1>Welcome! 👋</h1>
        <p>Let's set up your AI profile</p>
      </div>
      
      <div class="setup-content">
        <div class="setup-step">
          <h3>📸 Upload Your Images</h3>
          <p>We need these images to create realistic try-ons</p>
          
          <div class="image-upload-grid">
            <div class="upload-section">
              <h4>Face Image</h4>
              <div class="image-upload" data-type="face">
                <input type="file" id="faceImage" accept="image/*" style="display: none;">
                <div id="facePreview" class="image-preview">
                  <div class="upload-placeholder">
                    <span>👤</span>
                    <p>Upload face photo</p>
                  </div>
                </div>
                <button class="btn btn-secondary" onclick="document.getElementById('faceImage').click()">
                  Choose Image
                </button>
              </div>
            </div>
            
            <div class="upload-section">
              <h4>Full Body Image</h4>
              <div class="image-upload" data-type="body">
                <input type="file" id="bodyImage" accept="image/*" style="display: none;">
                <div id="bodyPreview" class="image-preview">
                  <div class="upload-placeholder">
                    <span>🧍</span>
                    <p>Upload full body photo</p>
                  </div>
                </div>
                <button class="btn btn-secondary" onclick="document.getElementById('bodyImage').click()">
                  Choose Image
                </button>
              </div>
            </div>
          </div>
          
          <div class="setup-tips">
            <h4>📝 Tips for best results:</h4>
            <ul>
              <li>Use clear, well-lit photos</li>
              <li>Face should be clearly visible</li>
              <li>Stand straight in full body photo</li>
              <li>Avoid busy backgrounds</li>
            </ul>
          </div>
          
          <button id="complete-setup" class="btn btn-primary" disabled>
            Complete Setup
          </button>
        </div>
      </div>
    </div>

    <!-- Main App State -->
    <div id="main-app" class="main-container" style="display: none;">
      <!-- Header with User Info -->
      <div class="app-header">
        <div class="user-info">
          <img id="user-avatar" src="" alt="User" class="user-avatar">
          <div class="user-details">
            <span id="user-name" class="user-name"></span>
            <span id="user-tier" class="user-tier"></span>
          </div>
        </div>
        <div class="header-actions">
          <button id="settings-btn" class="icon-btn" title="Settings">
            ⚙️
          </button>
          <button id="logout-btn" class="icon-btn" title="Logout">
            🚪
          </button>
        </div>
      </div>

      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="try-on">
          🎭 Try-On
        </button>
        <button class="nav-tab" data-tab="feed">
          📱 Feed
        </button>
        <button class="nav-tab" data-tab="collections">
          📂 Collections
        </button>
      </div>

      <!-- Try-On Tab -->
      <div id="try-on-tab" class="tab-content active">
        <div class="section">
          <h3>🎨 Generation Options</h3>
          <div class="generation-options">
            <label class="option-item">
              <input type="radio" name="generationType" value="image" checked>
              <span class="option-label">
                <span class="option-icon">🖼️</span>
                <span class="option-text">Image</span>
                <span class="option-cost">~$0.05</span>
              </span>
            </label>
            <label class="option-item">
              <input type="radio" name="generationType" value="video">
              <span class="option-label">
                <span class="option-icon">🎬</span>
                <span class="option-text">Video</span>
                <span class="option-cost">~$0.25</span>
              </span>
            </label>
          </div>
        </div>

        <div class="section">
          <h3>✨ Style</h3>
          <div class="style-options">
            <select id="style-select" class="style-select">
              <option value="realistic">📸 Realistic</option>
              <option value="fashion">👗 Fashion</option>
              <option value="artistic">🎨 Artistic</option>
              <option value="lifestyle">🌟 Lifestyle</option>
            </select>
          </div>
        </div>

        <div class="section">
          <h3>🎯 How to Use</h3>
          <ol class="instructions">
            <li>Go to any website with products</li>
            <li>Hover over a product image</li>
            <li>Click the V-Try badge that appears</li>
            <li>Choose your generation options</li>
            <li>Watch the magic happen! ✨</li>
          </ol>
        </div>

        <div class="section">
          <h3>📊 Usage Today</h3>
          <div class="usage-stats">
            <div class="stat">
              <span class="stat-number" id="images-used">0</span>
              <span class="stat-label">Images</span>
            </div>
            <div class="stat">
              <span class="stat-number" id="videos-used">0</span>
              <span class="stat-label">Videos</span>
            </div>
            <div class="stat">
              <span class="stat-number" id="credits-remaining">∞</span>
              <span class="stat-label">Credits</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Feed Tab -->
      <div id="feed-tab" class="tab-content">
        <div class="feed-header">
          <div class="feed-controls">
            <input type="search" id="feed-search" placeholder="Search your try-ons..." class="search-input">
            <select id="feed-filter" class="filter-select">
              <option value="all">All</option>
              <option value="image">Images</option>
              <option value="video">Videos</option>
              <option value="today">Today</option>
              <option value="week">This Week</option>
            </select>
          </div>
        </div>

        <div id="feed-content" class="feed-content">
          <div class="feed-loading" id="feed-loading">
            <div class="loading-spinner"></div>
            <p>Loading your try-ons...</p>
          </div>
          
          <div class="feed-empty" id="feed-empty" style="display: none;">
            <div class="empty-state">
              <span class="empty-icon">🎭</span>
              <h3>No try-ons yet!</h3>
              <p>Start trying on products to see them here</p>
            </div>
          </div>
          
          <div id="feed-results" class="feed-results"></div>
        </div>
      </div>

      <!-- Collections Tab -->
      <div id="collections-tab" class="tab-content">
        <div class="collections-header">
          <h3>📂 Your Collections</h3>
          <button id="create-collection-btn" class="btn btn-secondary">
            + New Collection
          </button>
        </div>
        
        <div id="collections-content" class="collections-content">
          <div class="collections-loading" id="collections-loading">
            <div class="loading-spinner"></div>
            <p>Loading collections...</p>
          </div>
          
          <div id="collections-list" class="collections-list"></div>
        </div>
      </div>
    </div>

    <!-- Generation Modal -->
    <div id="generation-modal" class="modal" style="display: none;">
      <div class="modal-content">
        <div class="modal-header">
          <h3>🎭 Generating Your Try-On</h3>
          <button id="close-generation-modal" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="generation-progress">
            <div class="progress-bar">
              <div class="progress-fill" id="progress-fill"></div>
            </div>
            <p id="generation-status">Starting generation...</p>
          </div>
          <div class="generation-preview" id="generation-preview">
            <img id="original-image" src="" alt="Original" class="preview-image">
            <div class="arrow">→</div>
            <div class="result-placeholder">
              <div class="loading-spinner"></div>
              <p>Generating...</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="shared/constants.js"></script>
  <script src="shared/types.js"></script>
  <script src="services/auth.js"></script>
  <script src="services/ai.js"></script>
  <script src="services/feed.js"></script>
  <script src="popup-v2.js"></script>
</body>
</html>
